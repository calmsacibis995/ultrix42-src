.TH cord2 1 RISC
.SH Name
cord2 \- rearranges basic blocks in an executable file to facilitate
better cache mapping.
.SH Syntax
.B "cord2 [-v] [-o \fIoutfile]\fB [-c \fIcachewords\fB] [-d] [-b \fIbridge_limit\fB] [-n] [-A \fIaddersfile\fB] [[-C \fIcountsfile\fB] ...] \fIobj\fB"
.SH Description
The \fBcord2\fR command
extracts basic blocks from a program and deposits them in a new
area in the text, making jumps to and from that area as necessary.
By separating the basic blocks, you can
reduce instruction cache miss rates. 
The
.B cord2 
command takes the output of a pixie profiling run as input (see 
.MS pixie 1 ).
.PP
The executable object file has the suffix 
.I obj.
The 
\fBcord2\fR command only requires one \fIaddersfile\fR; it creates the filename
by appending \fI.Bbaddrs\fR to the \fIobj\fR filename if none is specified 
with \fB-A\fR. Multiple counts files can be specified from many runs 
with multiple \fB-C\fR arguments.  If none are specified, \fBcord2\fR 
creates the counts filename by appending \fI.Counts\fR to the \fIobj\fR name.
.PP
Multiple counts files are added together into an internal counts array
represented with C double-type elements. The counts array elements contain
the density of a block or cycles/byte.  If you specify \fB-n\fR, then
the counts are normalized so that each counts array entry is
cycles/totalcycles.  When one counts file is specified, the default is to favor
small blocks; \fB-n\fR negates that.  When many counts files are specified,
\fB-n\fR also negates favoring one counts file. This is because its totalcycles
may exceed the totalcycles of another counts file.
.PP
The
\fBcord2\fR command determines which basic blocks to insert by sorting the
counts array and collecting the blocks with the highest counts that can
fit into the new area.  The \fBcord2\fR command may skip over huge 
blocks that do not fit at the end of the new area.
.PP
Once the blocks are determined, they are inserted into the new area, and their
original location is modified to jump to the new area.  At the end of
each block in the new area, a jump is added back to the original block's
subsequent or fall-through location, and the branch/jump target
(if necessary).  Both entering and exiting the new area is optimized to 
take advantage of other blocks in the new area and jump delay slots.
.PP
Often, there may be one or more fall-through blocks of a block in
the new area which are small, hardly ever used, and not in the
new area.  If the block following these fall-through blocks is in the
new area, the fall-through blocks are called bridge blocks.  It may be
more costly to generate jumps to and from bridge blocks rather than to 
simply copy them.
.PP
The
\fBcord2\fR command allows you to specify that bridge blocks be added to 
the new area if they total less than the \fIbridge_limit\fR instructions 
between two new-area blocks. You can specify the \fIbridge_limit\fR with 
\fB-b\fR; the default is zero.  Bridge blocks can bump blocks out of the 
new area that might normally fit into it.
.PP
.NT
Because the \fBcord2\fR command works from profile output, the resulting 
binary is data dependent. In other words, it may perform well only on the 
same input data that generated the profile information, and may perform 
worse than the original binary on other data.  Furthermore, if the hot 
areas in the cache do not fit well into one cachepage, performance can 
degrade.
.NE
.SH Options
The 
.B cord2
command also accepts these options:
.TP 5
.B -d
Fill the delay slots with nops only when adding jumps to and from the 
new area.
.TP 5
.B -v
Print verbose information. This includes statistics about the \fBcord2\fR
process.
.TP 5
.B "-v -v"
Print all of the \fB-v\fR information, but include detailed disassemblies of
the code moved, changed, and generated by \fBcord2\fR.
.TP 5
.B "-c cachewords"
Specify the number of words in the cache of the machine on which you
want to execute.  This is actually the size of the new area. The
\fIcachesize\fR may be a misnomer, as you can specify a size other
than your machine's cache size; however, it is probably the correct number.
.TP 5
.B "-o outputfile"
Specify the output file.  If it is not specified, the default 
is \fIa.out.cord2\fR.
.SH Restrictions
The 
.B cord2
command adds the new area to the end of text so any program using the
\fIetext\fR symbol may not work.  See 
.MS ld 1 .
.SH See Also
pixie(1), cord(1)
