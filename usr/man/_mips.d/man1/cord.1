.TH cord 1 RISC
.SH Name
cord \- rearranges procedures in an executable to facilitate better cache mapping.
.SH Syntax
.B cord 
[
.B \-c 
.I cachesize
] [
.B \-f
] [
.B \-o
.I outfile
] [
.B \-p 
.I maxphases
] [
.B \-v
]
.I obj reorder
.SH Description
The 
.PN cord
command
rearranges procedures in an executable object to maximize efficiency in
a machine's cache. By rearranging the procedures properly, the 
instruction cache miss rate is reduced. The 
.PN cord 
command does not attempt to
determine the correct ordering, but is given a 
.I reorder 
file containing
the desired procedure order. The 
.I reorder 
file is generated by the 
.PN ftoc
program which in turn generates a 
.I reorder 
file from a set of
profile feedback files (see 
.MS prof 1
).
.NXR "cord command"
.PP
Processed lines in the 
.I reorder 
file are called procedure lines.
Each procedure line must 
be on a separate source line. Each procedure line must contain the
source name of the file, followed by a blank followed by a qualified
procedure name (nested procedures need to be qualified x.y where x is
the outer procedure). A newline or blank can follow the procedure name:
.EX
foo.c bar >>i ignore this stuff<<
.EE
.PP
Lines beginning with a pound sign (#) are comments. 
Lines beginning with a dollar sign ($) are
considered
.PN cord
directive lines. The only directive currently understood
is 
.BR $phase . 
This directive will consider the rest of the file (until the
end of file or next 
.BR $phase ) 
as a new phase of the program and will order
the procedures accordingly. Procedures may appear in more than one phase, 
resulting in more than one copy of it in the final 
binary.  
The
.PN cord 
command will try to
relocate references to a procedure to a copy in the requesting phase's
list of procedures first and then a random copy if one is not found.
.PP
You should use the 
.B \-cord
option to a compiler driver like 
.PN cc
rather than execute cord directly. Options to 
.PN cord 
can be specified
with 
.B \-Wz,\fIcordarg0,cordarg1,...\fP. 
If you have to run 
.PN cord 
manually, you should run it once with the driver using the 
.B \-v
flag on a
simple program to see the exact passes and their arguments involved in
using 
.PN cord .
.PP
The
.I obj
argument is an executable object with 
its relocation information intact. This
can be achieved by passing the 
.B \-r \-z \-d
options to the linker, 
.PN ld .
The 
.B \-r 
linker option maintains relocation 
information in the object, but will not make it a ZMAGIC file 
(hence 
.BR \-z )
nor will it allocate common variables 
(hence 
.BR \-d )
as it would without the 
option.
.SH Options
.IP "\-c \fIcachesize\fP" 15
Specify the cachesize of the machine you want to execute on in bytes. This
only affects the 
.B \-f 
option. If not specified 65536 is used.
.IP \-f
Flip the first cachepage size procedures. The assumption when 
.PN cord
was written was that procedures would be reordered by procedure
density (cycles/byte). This option ensures that the densest part of each
page following the first cachepage would 
conflict with least dense part of the first cachepage.
.IP "\-o \fIoutputfile\fP"
specifies the output file. If not specified, a.out is used.
.IP "\-p \fIphasemax\fP"
Specifies the maximum number of phases allowed. The default is 20.
.IP \-v
Prints verbose information. This 
includes listing those procedures considered
part of other procedures and cannot be rearranged (these are basically
assembler procedures that may contain relative branches 
to other procedures
rather than relocatable ones). The listing also list those procedures
in the flipped area (if any) and a mapping of old location to new.
.SH Restrictions
Since 
.PN cord
works from an input list of procedures generated from
profile output, the resulting binary is data dependent. 
In other words, it
may only perform well on the same input data that generated the profile
information and may perform worse than the original 
binary on other data. 
Furthermore, if the hot areas in the cache don't fit well into
one cachepage, performance can degrade.
.SH See Also
cc(1), ftoc(1), ld(1), prof(1)  
