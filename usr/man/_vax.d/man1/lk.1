.\" SCCSID: @(#)lk.1	3.3	2/2/88
.TH lk 1 VAX
.SH Name
lk \- link editor
.SH Syntax
.B lk
[\|\fIoption...\fR\|] \fIfile...\fR
.SH Description
.NXR "lk command"
.NXR "object file" "combining"
.NXS "link editor (VAX FORTRAN)" "lk command"
.NXA "ld command" "lk command"
.NXAM "lk command" "ar file"
.NXAM "lk command" "a.out file"
.NXA "lk command" "strip command"
.NXA "lk command" "ranlib command"
.NXA "cc compiler" "lk command"
The
.PN lk
command combines several object programs into one, resolves external
references, and searches libraries.
In the simplest case, several object
.I files
are given, and
.PN lk
combines them, producing an object module which can be executed.
The output of
.PN lk
is always a standard ULTRIX 
.PN a.out
object module. 
This file is made executable only if no errors occurred during the load.
.PP
The argument routines are linked together in the order
specified.  The entry point of the output is the
beginning of the first routine, unless the \fB\-e\fP 
option is specified.
.PP
If the argument is a library, it is searched only once
at the point it is encountered in the argument list.
Only those routines defining an unresolved external
reference are loaded.
If a routine from a library references another routine in the library
and the library has not been processed by 
.MS ranlib 1 ,
the referenced routine must
appear after the referencing routine in the library.
Thus the order of programs within libraries may be important.
The first member of a library should be a file named `\_\^\_.SYMDEF',
which is a dictionary for the library as produced by 
.MS ranlib 1 .
The dictionary is searched repeatedly
to satisfy as many references as possible.
.PP
The symbols `\_etext', `\_edata' and `\_end'
(`etext', `edata' and `end' in C)
are reserved, and if referred to,
are set to the first location above the program,
the first location above initialized data,
and the first location above all data in that order.
It is an error to define these symbols.
.PP
Like the 
.PN ld
linker, the 
.PN lk
linker can process ULTRIX
object modules, 
.PN a.out
files, archived libraries (.a files), and
ranlib-generated indexed libraries. 
Unlike the 
.PN ld
linker, however, the 
.PN lk
linker can also
process object modules generated by the VAX FORTRAN compiler.
All 
.PN lk
command options can also be specified on the 
.PN fort
command.
.SH Options
.NXR "lk command" "options"
The 
.PN lk
command has several options.
Except for
.B \-l,
they should appear before the file names.
.IP "\fB\-\|D\fI number\fR"  20
Sets data segment length. The `number' is a number specifying the
desired length of the data segment. The linker pads the data segment
to this length with zero bytes.
.IP "\fB\-\|e\fI symbol\fR" 20
Take the argument as the
name of the entry point of the loaded
program.  Location 0 is the default.
.IP "\fB\-\|H\fI number\fR" 20
Takes number argument as a decimal integer, adds it to end
of text, and starts data section at a higher
address.
.IP \fB\-K\fR 20
Produces full load map, cross-referencing all defined symbols.
.IP "\fB\-L\fIdir\fR" 20
Add
.I dir
to the list of directories in which libraries are searched for.
Directories specified with 
.B \-L
are searched before the standard directories.
.IP \fB\-l\fIx\fR 20
Abbreviation for the library name
.RI `/lib/lib x \&.a',
where
.I x
is a string.
If that does not exist,
.PN lk
tries 
.RI `/usr/lib/lib x \&.a'
A library is searched when its name is encountered,
so the placement of a
.B \-l
is significant.
.IP \fB\-M\fR 20
Produces full load map, consisting of a module and program section synopsis
and  symbol cross-reference.  Only symbols that are referenced appear
in the cross-reference.  Use 
.B \-K
to cross-reference all symbols.
.IP \fB\-N\fR 20
Do not make text portion read only or sharable.  
(Use magic number 0407.)
.IP \fB\-n\fR 20
Arranges (by giving the output file a 0410 ``magic number'') that
when the output file is executed,
the text portion is read-only and shared
among all users executing the file.
This involves moving the data areas up to the first
possible 1024 byte boundary following the
end of the text.
.IP "\fB\-\|o\fI name\fR" 20
Takes the 
.I name
argument after
.B \-o
as the name of the
.PN lk
output file, instead of
.PN a.out .
.IP \fB\-S\fR 20
Strips the output by removing all symbols except locals and globals.
.IP \fB\-s\fR 20
Removes the symbol table
and relocation bits to save space.  This impairs the
usefulness of the debuggers.
This information can also be removed by 
.MS strip 1 .
.IP "\fB\-\|T\fI number\fR" 20
Takes the argument as a hexadecimal number which sets the text segment
origin. 
The default origin is 0.
.IP \fB\-t\fR 20
Displays the name of each file as it is processed.
.IP "\fB\-\|u\fI symbol\fR" 20
Enters argument as undefined symbol in symbol table.  This is useful
for loading from a library, since initially the symbol
table is empty and an unresolved reference is needed
to force the loading of the first routine.
.IP \fB\-X\fR 20
Saves local symbols
except for those whose names begin with `L'.
This option is used by 
.MS cc 1 
to discard internally-generated labels while
retaining symbols local to routines.
.IP \fB\-x\fR 20
Suppresses saving nonglobal symbols in output symbol table; enters only external
symbols.  
This option saves some space in the output file.
.IP "\fB\-Y\fIenvironment\fR" 20
Adjust the magic number in the output file so that the program runs in 
the specified
.I environment .
The parameter can be POSIX, SYSTEM_FIVE, or BSD.
The parameter sets the program's execution environment to conform with
one of the three standards.  This parameter overrides the PROG_ENV
environment variable, if it is present.
If neither this parameter nor the PROG_ENV variable is
present, \fB\-Y\fRBSD is assumed.
.IP \fB\-y\fIsym\fR 20
Indicates each file in which
.I sym
appears, its type and whether the file defines or references it.
Many such options may be given to trace many symbols.
(It is usually necessary to begin
.I sym
with an `_', as external C and PASCAL variables begin with underscores.)
.IP \fB\-z\fR 20
Loads process on demand from the resulting executable file (413 format)
rather than preloaded.
This is the default.
It results in a 1024 byte header on the output file followed by
a text and data segment, whose size is a multiple of 1024 bytes
(being padded out with nulls in the file if necessary).
With this format the first few BSS segment symbols may actually appear,
from the output of
.MS size 1 ,
to live in the data segment.
This avoids wasting the space which results from 
the data segment size roundup.
.PP
The
.PN lk
linker
does not support the following 
.PN ld
options:
.B \-A,
.B \-d,
or
.B \-r.
.SH Restrictions
.NXR "lk command" "restricted"
The
.PN lk
command
pads the images which are to be demand loaded from
the file system to the next page boundary.
.PP
When linking code containing GFLOAT instructions,
the GFLOAT versions of 
.I libc
and/or the math library must be
used rather than the normal DFLOAT versions.  Link to these by using
.I \-lcg
and/or
.I \-lmg. 
.PP
The compiler and the linker 
.MS lk 1 
cannot detect the use of mixed double floating point 
types, and your program may produce erroneous results.
.SH Files
.ta \w'/usr/local/lib/lib*.a\ \ 'u
/lib/lib*.a	libraries
.br
/usr/lib/lib*.a	libraries
.br
/usr/local/lib/lib*.a	libraries
.br
a.out	output file
.br
a.map	map file
.SH See Also
ar(1), as(1), cc(1), ld(1), ranlib(1)
